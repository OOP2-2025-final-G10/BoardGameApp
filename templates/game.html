<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>人生ゲーム - プレイ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='base-style.css') }}">
</head>

<body class="game-page">
<div class="game-container">

    <div class="game-main">
        <div class="map-area box-border">
            <div class="zoom-btns">
                <button>+</button>
                <button>-</button>
            </div>
        </div>

        <div class="bottom-area">
            <div class="roulette-container box-border">
                <button class="roulette-circle">まわす</button>
            </div>
            <div class="game-logo box-border">人生ゲーム</div>
        </div>
    </div>

    <aside class="info-sidebar box-border">
        <details open>
            <summary>ユーザー</summary>
            <ul id="userList"></ul>
        </details>
        
        <ul class="status-info" id="userInfo">
            <li>・ 名前：<span id="stat-name">-</span></li>
            <li>・ 所持金：<span id="stat-money">-</span></li>
            <li>・ 職業：<span id="stat-job">-</span></li>
        </ul>
    </aside>

</div>

<script id="users-data" type="application/json">
    {{ users|tojson }}
</script>

<script>
    /**
     * 2. 安全にデータを読み込む
     * JSON.parse を使うことで、エディタにエラーを出させずにデータを取得できます
     */
    const usersData = JSON.parse(document.getElementById('users-data').textContent);

    function renderUserList() {
        const userListElement = document.getElementById('userList');
        if (!userListElement) return; // 要素がない場合は何もしない
        
        userListElement.innerHTML = ''; 

        Object.keys(usersData).forEach(uid => {
            const uinfo = usersData[uid];
            const li = document.createElement('li');
            const btn = document.createElement('button');
            
            btn.type = 'button';
            btn.className = 'user-link'; 
            btn.textContent = uinfo.name;
            btn.onclick = () => showUserInfo(uid);
            
            li.appendChild(btn);
            userListElement.appendChild(li);
        });
    }

    function showUserInfo(userId) {
        const user = usersData[userId];
        if (user) {
            document.getElementById('stat-name').textContent = user.name;
            document.getElementById('stat-money').textContent = user.money;
            document.getElementById('stat-job').textContent = user.job;
        }
    }

    document.addEventListener('DOMContentLoaded', renderUserList);
</script>

</body>
</html>